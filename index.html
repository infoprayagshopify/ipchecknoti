<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Change Notification</title>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>
<body>
    <h1>IP Change Notification</h1>
    <p>Allow notifications to get alerts when your IP changes.</p>

    <script>
        let lastIP = null;

        // Initialize OneSignal
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function(OneSignal) {
            await OneSignal.init({
                appId: "e4d90da2-9a92-4c5c-947a-30418fc8b661",
                safari_web_id: "web.onesignal.auto.1a94b592-c98a-427e-9490-520bfcd23754",
                notifyButton: { enable: true },
                serviceWorkerPath: "OneSignalSDKWorker.js"  // âœ… Fixes Service Worker issue
            });
        });

        // Function to check IP
        async function checkIPChange() {
            try {
                const response = await fetch("https://api.ipify.org?format=json");
                const data = await response.json();
                let currentIP = data.ip;

                if (lastIP && lastIP !== currentIP) {
                    sendPushNotification(currentIP);
                }
                lastIP = currentIP;
            } catch (error) {
                console.error("Error fetching IP:", error);
            }
        }

        // Function to send OneSignal notification
        async function sendPushNotification(ip) {
            const OneSignal = window.OneSignal;
            if (!OneSignal) return;

            await OneSignal.sendNotification("IP Changed!", {
                body: `Your new IP: ${ip}`,
                icon: "https://cdn-icons-png.flaticon.com/512/1827/1827504.png",
                url: "https://infoprayagshopify.github.io/ipchecknoti/"
            });
        }

        // Check IP every 2 seconds
        setInterval(checkIPChange, 2000);
    </script>
</body>
</html>
